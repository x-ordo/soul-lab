/**
 * AI Fallback Templates
 *
 * Static templates for graceful degradation when AI APIs fail.
 * Provides meaningful responses without LLM calls.
 */

import type { DrawnCard, TarotReading } from '../tarot/engine.js';

// Zodiac-based fallback messages
const ZODIAC_DAILY_MESSAGES: Record<string, string[]> = {
  ì–‘ìë¦¬: [
    'ì˜¤ëŠ˜ì€ ìƒˆë¡œìš´ ë„ì „ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. ë‹¹ì‹ ì˜ ì—´ì •ì´ ë¹›ì„ ë°œí•  ê±°ì˜ˆìš” âœ¨',
    'í™”ì„±ì˜ ì—ë„ˆì§€ê°€ ë‹¹ì‹ ì—ê²Œ ìš©ê¸°ë¥¼ ë¶ˆì–´ë„£ê³  ìˆì–´ìš”. ë‘ë ¤ì›€ ì—†ì´ ë‚˜ì•„ê°€ì„¸ìš” ğŸ”¥',
  ],
  í™©ì†Œìë¦¬: [
    'ì•ˆì •ê³¼ í’ìš”ì˜ ì—ë„ˆì§€ê°€ ë‹¹ì‹ ì„ ê°ì‹¸ê³  ìˆì–´ìš”. ì²œì²œíˆ, í™•ì‹¤í•˜ê²Œ ë‚˜ì•„ê°€ì„¸ìš” ğŸŒ¿',
    'ê¸ˆì„±ì˜ ì¶•ë³µì´ ë‹¹ì‹ ì˜ í•˜ë£¨ë¥¼ ë”°ìŠ¤í•˜ê²Œ ê°ì‹¸ì¤„ ê±°ì˜ˆìš”. ì•„ë¦„ë‹¤ì›€ì„ ëˆ„ë¦¬ì„¸ìš” ğŸ’«',
  ],
  ìŒë‘¥ì´ìë¦¬: [
    'ì†Œí†µì˜ ë³„ì´ ë¹›ë‚˜ê³  ìˆì–´ìš”. ëŒ€í™”ë¥¼ í†µí•´ ìƒˆë¡œìš´ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ ê±°ì˜ˆìš” ğŸ’¬',
    'í˜¸ê¸°ì‹¬ì´ í–‰ìš´ì„ ë¶€ë¥´ëŠ” ë‚ ì´ì—ìš”. ìƒˆë¡œìš´ ê²ƒì„ ë°°ì›Œë³´ì„¸ìš” ğŸ“š',
  ],
  ê²Œìë¦¬: [
    'ë‹¬ì˜ ì—ë„ˆì§€ê°€ ë‹¹ì‹ ì˜ ì§ê´€ì„ ë†’ì´ê³  ìˆì–´ìš”. ë§ˆìŒì˜ ì†Œë¦¬ë¥¼ ë“¤ì–´ë³´ì„¸ìš” ğŸŒ™',
    'ê°€ì¡±ê³¼ ì§‘ì— ê´€ë ¨ëœ ì¢‹ì€ ì†Œì‹ì´ ìˆì„ ìˆ˜ ìˆì–´ìš”. ì†Œì¤‘í•œ ì‚¬ëŒë“¤ê³¼ ì‹œê°„ì„ ë³´ë‚´ì„¸ìš” ğŸ ',
  ],
  ì‚¬ììë¦¬: [
    'íƒœì–‘ì˜ ë¹›ì´ ë‹¹ì‹ ì„ ë¹„ì¶”ê³  ìˆì–´ìš”. ìì‹ ê°ì„ ê°€ì§€ê³  ë¬´ëŒ€ ì¤‘ì•™ì— ì„œì„¸ìš” â˜€ï¸',
    'ì°½ì¡°ì  ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ” ë‚ ì´ì—ìš”. ë‹¹ì‹ ì˜ ì¬ëŠ¥ì„ ë§ˆìŒê» í¼ì³ë³´ì„¸ìš” ğŸ­',
  ],
  ì²˜ë…€ìë¦¬: [
    'ì„¸ì‹¬í•œ ê´€ì°°ë ¥ì´ ê¸°íšŒë¥¼ ë°œê²¬í•˜ê²Œ í•´ì¤„ ê±°ì˜ˆìš”. ë””í…Œì¼ì— ì£¼ëª©í•˜ì„¸ìš” ğŸ”',
    'ê±´ê°•ê³¼ ì¼ìƒì— ê¸ì •ì ì¸ ë³€í™”ê°€ ì°¾ì•„ì˜¬ ìˆ˜ ìˆì–´ìš”. ì‘ì€ ìŠµê´€ì´ í° ì°¨ì´ë¥¼ ë§Œë“¤ì–´ìš” ğŸŒ±',
  ],
  ì²œì¹­ìë¦¬: [
    'ì¡°í™”ì™€ ê· í˜•ì˜ ì—ë„ˆì§€ê°€ ë‹¹ì‹ ê³¼ í•¨ê»˜í•´ìš”. ê´€ê³„ì—ì„œ ì•„ë¦„ë‹¤ìš´ ìˆœê°„ì´ ì°¾ì•„ì˜¬ ê±°ì˜ˆìš” âš–ï¸',
    'ê¸ˆì„±ì˜ ì€ì´ì´ ë‹¹ì‹ ì˜ ë§¤ë ¥ì„ ë¹›ë‚˜ê²Œ í•´ì¤„ ê±°ì˜ˆìš”. ì‚¬ë‘ì´ ê°€ê¹Œì´ ìˆì–´ìš” ğŸ’•',
  ],
  ì „ê°ˆìë¦¬: [
    'ê¹Šì€ í†µì°°ë ¥ìœ¼ë¡œ ìˆ¨ê²¨ì§„ ì§„ì‹¤ì„ ë°œê²¬í•  ìˆ˜ ìˆì–´ìš”. ì§ê´€ì„ ë¯¿ìœ¼ì„¸ìš” ğŸ¦‚',
    'ë³€í™”ì˜ ì—ë„ˆì§€ê°€ ê°•í•˜ê²Œ ëŠê»´ì§€ëŠ” ë‚ ì´ì—ìš”. ë‘ë ¤ì›Œí•˜ì§€ ë§ê³  ë³€ì‹ í•˜ì„¸ìš” ğŸ”®',
  ],
  ì‚¬ìˆ˜ìë¦¬: [
    'ëª¨í—˜ì˜ ë³„ì´ ë¹›ë‚˜ê³  ìˆì–´ìš”. ìƒˆë¡œìš´ ê²½í—˜ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë ¤ìš” ğŸ¹',
    'ë‚™ê´€ì ì¸ ì—ë„ˆì§€ê°€ í–‰ìš´ì„ ëŒì–´ë‹¹ê¸°ê³  ìˆì–´ìš”. í° ê·¸ë¦¼ì„ ê·¸ë ¤ë³´ì„¸ìš” ğŸŒˆ',
  ],
  ì—¼ì†Œìë¦¬: [
    'ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ê²°ì‹¤ì„ ë§ºëŠ” ë‚ ì´ì—ìš”. ëª©í‘œë¥¼ í–¥í•´ í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ì„¸ìš” ğŸ”ï¸',
    'ì±…ì„ê°ê³¼ ì„±ì‹¤í•¨ì´ ì¸ì •ë°›ì„ ê±°ì˜ˆìš”. ë‹¹ì‹ ì˜ ë…¸ë ¥ì„ ë¯¿ìœ¼ì„¸ìš” â­',
  ],
  ë¬¼ë³‘ìë¦¬: [
    'ë…ì°½ì ì¸ ì•„ì´ë””ì–´ê°€ ë¹›ì„ ë°œí•  ë‚ ì´ì—ìš”. í‹€ì„ ê¹¨ê³  ìƒˆë¡œìš´ ê¸¸ì„ ì°¾ì•„ë³´ì„¸ìš” ğŸ’¡',
    'ìš°ì •ê³¼ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì¢‹ì€ ì—ë„ˆì§€ê°€ íë¥´ê³  ìˆì–´ìš”. í•¨ê»˜í•˜ëŠ” í˜ì„ ëŠê»´ë³´ì„¸ìš” ğŸ¤',
  ],
  ë¬¼ê³ ê¸°ìë¦¬: [
    'ìƒìƒë ¥ê³¼ ì˜ê°ì´ ë„˜ì¹˜ëŠ” ë‚ ì´ì—ìš”. ê¿ˆì„ í˜„ì‹¤ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” í˜ì´ ìˆì–´ìš” ğŸŸ',
    'ì§ê´€ê³¼ ê³µê° ëŠ¥ë ¥ì´ ë†’ì•„ì§€ëŠ” ë‚ ì´ì—ìš”. ë§ˆìŒì˜ ëˆˆìœ¼ë¡œ ì„¸ìƒì„ ë°”ë¼ë³´ì„¸ìš” ğŸŒŠ',
  ],
};

// Default message when zodiac is unknown
const DEFAULT_DAILY_MESSAGE = 'ì˜¤ëŠ˜ í•˜ëŠ˜ì˜ ë³„ë“¤ì´ ë‹¹ì‹ ì„ ì‘ì›í•˜ê³  ìˆì–´ìš”. ì¢‹ì€ í•˜ë£¨ ë³´ë‚´ì„¸ìš” âœ¨';

/**
 * Generate fallback daily fortune based on zodiac
 */
export function getFallbackDailyFortune(zodiacSign?: string): string {
  if (!zodiacSign) {
    return DEFAULT_DAILY_MESSAGE;
  }

  const messages = ZODIAC_DAILY_MESSAGES[zodiacSign];
  if (!messages || messages.length === 0) {
    return DEFAULT_DAILY_MESSAGE;
  }

  // Deterministic selection based on date
  const today = new Date().toISOString().split('T')[0];
  const index = today.split('-').reduce((a, b) => a + parseInt(b), 0) % messages.length;
  return messages[index];
}

/**
 * Generate fallback tarot interpretation
 */
export function getFallbackTarotInterpretation(reading: TarotReading): string {
  const parts: string[] = ['âœ¨ íƒ€ë¡œ ì¹´ë“œê°€ ì „í•˜ëŠ” ë©”ì‹œì§€ì…ë‹ˆë‹¤.\n'];

  for (const card of reading.spread) {
    const direction = card.isReversed ? 'ì—­ë°©í–¥' : 'ì •ë°©í–¥';
    parts.push(`**${card.positionKorean}**: ${card.emoji} ${card.nameKorean} (${direction})`);
    parts.push(`í‚¤ì›Œë“œ: ${card.keywords.slice(0, 3).join(', ')}\n`);
  }

  parts.push('\nğŸ”® ì¹´ë“œë“¤ì´ ë‹¹ì‹ ì—ê²Œ ì „í•˜ëŠ” ë©”ì‹œì§€:');
  parts.push('ì§€ê¸ˆ ì´ ìˆœê°„, ìš°ì£¼ê°€ ë‹¹ì‹ ê³¼ ì†Œí†µí•˜ê³  ìˆì–´ìš”.');
  parts.push('ê° ì¹´ë“œì˜ ì˜ë¯¸ë¥¼ ë§ˆìŒ ê¹Šì´ ë˜ìƒˆê²¨ë³´ì„¸ìš”.');
  parts.push('ë‹µì€ ì´ë¯¸ ë‹¹ì‹  ì•ˆì— ìˆìŠµë‹ˆë‹¤. âœ¨');

  return parts.join('\n');
}

/**
 * Generate fallback synastry analysis
 */
export function getFallbackSynastryAnalysis(
  zodiac1: string,
  zodiac2: string,
  score: number
): string {
  let compatibility: string;
  if (score >= 80) {
    compatibility = 'ë§¤ìš° ë†’ì€ ê¶í•©';
  } else if (score >= 60) {
    compatibility = 'ì¢‹ì€ ê¶í•©';
  } else if (score >= 40) {
    compatibility = 'ë³´í†µ ê¶í•©';
  } else {
    compatibility = 'ë„ì „ì ì¸ ê¶í•©';
  }

  return `âœ¨ ${zodiac1}ì™€(ê³¼) ${zodiac2}ì˜ ê¶í•© ë¶„ì„

**ê¶í•© ì ìˆ˜**: ${score}ì  (${compatibility})

ğŸŒŸ ë‘ ë³„ìë¦¬ì˜ ë§Œë‚¨:
${zodiac1}ì˜ ì—ë„ˆì§€ì™€ ${zodiac2}ì˜ ì—ë„ˆì§€ê°€ ë§Œë‚˜ íŠ¹ë³„í•œ ì¡°í™”ë¥¼ ì´ë£¨ê³  ìˆì–´ìš”.

ğŸ’« ê´€ê³„ì˜ ì¥ì :
ì„œë¡œì˜ ì°¨ì´ì ì´ ì˜¤íˆë ¤ ì„±ì¥ì˜ ê¸°íšŒê°€ ë  ìˆ˜ ìˆì–´ìš”.
ì—´ë¦° ë§ˆìŒìœ¼ë¡œ ìƒëŒ€ë°©ì„ ì´í•´í•˜ë ¤ ë…¸ë ¥í•˜ë©´ ë”ìš± ê¹Šì€ ìœ ëŒ€ë¥¼ í˜•ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸŒ™ ì¡°ì–¸:
ì§„ì •í•œ ê¶í•©ì€ ë³„ìë¦¬ë³´ë‹¤ ì„œë¡œë¥¼ í–¥í•œ ë§ˆìŒì—ì„œ ë¹„ë¡¯ë©ë‹ˆë‹¤.
ì‚¬ë‘ê³¼ ì´í•´ë¡œ í•¨ê»˜ ì„±ì¥í•´ ë‚˜ê°€ì„¸ìš”. âœ¨`;
}

/**
 * Generate fallback chat response
 */
export function getFallbackChatResponse(question: string, zodiacSign?: string): string {
  const zodiacPart = zodiacSign ? `${zodiacSign}ì¸ ë‹¹ì‹ ì—ê²Œ ` : '';

  return `ğŸŒŸ ${zodiacPart}ë³„ë“¤ì´ ì „í•˜ëŠ” ë©”ì‹œì§€ì˜ˆìš”.

"${question.slice(0, 50)}${question.length > 50 ? '...' : ''}"

ì§€ê¸ˆ ì´ ìˆœê°„, ìš°ì£¼ì˜ ì—ë„ˆì§€ê°€ ë‹¹ì‹ ê³¼ í•¨ê»˜í•˜ê³  ìˆì–´ìš”.
ë§ˆìŒì˜ ì†Œë¦¬ì— ê·€ ê¸°ìš¸ì—¬ ë³´ì„¸ìš”. ë‹µì€ ì´ë¯¸ ë‹¹ì‹  ì•ˆì— ìˆìŠµë‹ˆë‹¤.

ì ì‹œ ëˆˆì„ ê°ê³  ê¹Šì€ í˜¸í¡ì„ í•´ë³´ì„¸ìš”.
ë‹¹ì‹ ì˜ ì§ê´€ì´ ì˜¬ë°”ë¥¸ ë°©í–¥ì„ ì•Œë ¤ì¤„ ê±°ì˜ˆìš”. âœ¨

ğŸ”® ì˜¤ëŠ˜ì˜ ì¡°ì–¸: ì¡°ê¸‰í•´í•˜ì§€ ë§ˆì„¸ìš”. ëª¨ë“  ê²ƒì€ ì œë•Œì— ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.`;
}

/**
 * Generate fallback consult response
 */
export function getFallbackConsultResponse(
  type: string,
  zodiacSign?: string,
  dailyCard?: DrawnCard
): string {
  const zodiacPart = zodiacSign ? `${zodiacSign}ì¸ ë‹¹ì‹ ` : 'ë‹¹ì‹ ';
  const cardPart = dailyCard
    ? `\n\nì˜¤ëŠ˜ì˜ íƒ€ë¡œ: ${dailyCard.emoji} ${dailyCard.nameKorean}`
    : '';

  const typeMessages: Record<string, string> = {
    love: 'ì‚¬ë‘ì— ê´€í•œ ì§ˆë¬¸ì´ì‹œêµ°ìš”. ë§ˆìŒì„ ì—´ë©´ ì‚¬ë‘ì€ ì°¾ì•„ì˜µë‹ˆë‹¤.',
    career: 'ì§„ë¡œì™€ ì§ì—…ì— ëŒ€í•œ ê³ ë¯¼ì´ì‹œêµ°ìš”. ë‹¹ì‹ ì˜ ì—´ì •ì„ ë”°ë¥´ì„¸ìš”.',
    money: 'ì¬ë¬¼ìš´ì´ ê¶ê¸ˆí•˜ì‹œêµ°ìš”. í˜„ëª…í•œ ì„ íƒì´ í’ìš”ë¥¼ ê°€ì ¸ì˜¬ ê±°ì˜ˆìš”.',
    health: 'ê±´ê°•ì— ëŒ€í•´ ìƒê°í•˜ê³  ê³„ì‹œêµ°ìš”. ëª¸ê³¼ ë§ˆìŒì˜ ê· í˜•ì´ ì¤‘ìš”í•´ìš”.',
    default: 'ìš°ì£¼ì˜ ì§€í˜œê°€ ë‹¹ì‹ ì˜ ì§ˆë¬¸ì— ë‹µí•˜ê³  ìˆì–´ìš”.',
  };

  const message = typeMessages[type] || typeMessages.default;

  return `âœ¨ ${zodiacPart}ì—ê²Œ ì „í•˜ëŠ” ë©”ì‹œì§€${cardPart}

${message}

ì§€ê¸ˆ ì´ ìˆœê°„ì„ ì†Œì¤‘íˆ ì—¬ê¸°ì„¸ìš”.
ë³„ë“¤ì´ ë‹¹ì‹ ì˜ ì—¬ì •ì„ ë°í˜€ì¤„ ê±°ì˜ˆìš”.

ğŸŒ™ ì˜¤ëŠ˜ì˜ ì—ë„ˆì§€: ê¸ì •ì ì¸ ë³€í™”ì˜ ê¸°ìš´ì´ ê°ì§€ë©ë‹ˆë‹¤.
ğŸ’« ì¡°ì–¸: ì§ê´€ì„ ë¯¿ê³  í•œ ê±¸ìŒ í•œ ê±¸ìŒ ë‚˜ì•„ê°€ì„¸ìš”.`;
}
